<script>
// ===== OPEN/CLOSE CHAT =====
const botBtn = document.getElementById("chatbotToggle");
const botWin = document.getElementById("chatbotWindow");
botBtn.onclick = () => {
    botWin.style.display = botWin.style.display === "flex" ? "none" : "flex";
};

// ===== ELEMENTS =====
const botMsgBox = document.getElementById("chatbotMessages");
const botInput = document.getElementById("chatbotInput");
const botSend = document.getElementById("chatbotSend");

function botReply(text){
    let msg = `<div class="botMsg">${text}</div>`;
    botMsgBox.innerHTML += msg;
    botMsgBox.scrollTop = botMsgBox.scrollHeight;
}

/* =====================================================
   INTERNET SEARCH (NO API KEY) â€” DuckDuckGo Instant Answer
   ===================================================== */
async function internetSearch(query){
    try {
        const url = "https://api.duckduckgo.com/?q=" + encodeURIComponent(query) + "&format=json&no_redirect=1&no_html=1";
        const res = await fetch(url);
        const data = await res.json();

        // Priority 1: Abstract (direct answer)
        if (data.Abstract && data.Abstract.length > 3) {
            return data.Abstract;
        }

        // Priority 2: RelatedTopics (fallback)
        if (data.RelatedTopics && data.RelatedTopics.length > 0) {
            let topic = data.RelatedTopics[0];
            if (topic.Text) return topic.Text;
        }

        // Nothing found
        return "I searched the web, but couldn't find a clear answer.";
    } catch (err) {
        return "Internet search failed (network or API issue).";
    }
}

/* =====================================================
   SEND MESSAGE
   ===================================================== */
async function sendUserMessage(){
    let text = botInput.value.trim();
    if(!text) return;

    // Show user message
    botMsgBox.innerHTML += `<div class="userMsg">${text}</div>`;
    botInput.value = "";
    botMsgBox.scrollTop = botMsgBox.scrollHeight;

    // Temporary "thinking..."
    botReply("ðŸ” Searchingâ€¦");

    // Fetch online info
    let answer = await internetSearch(text);

    // Remove last "Searchingâ€¦" and replace
    botMsgBox.innerHTML = botMsgBox.innerHTML.replace("ðŸ” Searchingâ€¦", "");

    // Output final answer
    botReply(answer);
}

/* Button + Enter listener */
botSend.onclick = sendUserMessage;
botInput.addEventListener("keypress", e => { 
    if(e.key === "Enter") sendUserMessage(); 
});
</script>
